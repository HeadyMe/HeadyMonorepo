<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>HeadyLens - Complete System Observability</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #16213e 50%, #1a1a2e 100%);
            color: #e0e0e0;
            overflow-x: hidden;
        }

        /* Sacred Geometry Background */
        body::before {
            content: '';
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(0,212,255,0.03) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: breathe 8s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.3; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.5; }
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header with Logo */
        .header {
            text-align: center;
            padding: 30px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            border: 2px solid rgba(0, 212, 255, 0.3);
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .logo-ascii {
            font-family: monospace;
            font-size: 10px;
            line-height: 1.1;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .header h1 {
            font-size: 36px;
            background: linear-gradient(90deg, #00d4ff, #ff6b9d, #00d4ff);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 3s linear infinite;
            margin: 15px 0;
        }

        @keyframes gradient {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }

        .subtitle {
            color: #ff6b9d;
            font-size: 14px;
        }

        /* Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(0, 212, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .panel-full { grid-column: span 12; }
        .panel-half { grid-column: span 6; }
        .panel-third { grid-column: span 4; }
        .panel-quarter { grid-column: span 3; }

        .panel-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #00d4ff;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(0, 212, 255, 0.3);
        }

        /* Component Cards */
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .component-card {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.05), rgba(255, 107, 157, 0.05));
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            transition: all 0.3s ease;
        }

        .component-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
            border-color: #00d4ff;
        }

        .component-name {
            font-size: 16px;
            font-weight: bold;
            color: #00d4ff;
            margin-bottom: 8px;
        }

        .component-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.active { background: #00ff88; box-shadow: 0 0 10px #00ff88; }
        .status-dot.warning { background: #ffaa00; box-shadow: 0 0 10px #ffaa00; }
        .status-dot.error { background: #ff4444; box-shadow: 0 0 10px #ff4444; }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }

        .metric {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 13px;
        }

        .metric-value {
            color: #00ff88;
            font-weight: bold;
        }

        /* Time Series Chart Container */
        .chart-container {
            position: relative;
            height: 250px;
            margin-top: 15px;
        }

        /* Activity Feed */
        .activity-feed {
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }

        .activity-item {
            padding: 8px;
            margin: 5px 0;
            background: rgba(0, 212, 255, 0.05);
            border-left: 3px solid #00d4ff;
            border-radius: 5px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .timestamp {
            color: rgba(255, 255, 255, 0.5);
            font-size: 10px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(255, 107, 157, 0.1));
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            background: linear-gradient(90deg, #00d4ff, #ff6b9d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
        }

        /* Description Section */
        .description {
            background: rgba(0, 212, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #00d4ff;
            margin: 15px 0;
            font-size: 14px;
            line-height: 1.6;
        }

        .description h3 {
            color: #00d4ff;
            margin-bottom: 10px;
        }

        /* Footer Branding */
        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            border-top: 2px solid rgba(0, 212, 255, 0.3);
            color: #ff6b9d;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 212, 255, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 212, 255, 0.8);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <pre class="logo-ascii">    â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—
    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•
    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• 
    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘  â•šâ–ˆâ–ˆâ•”â•  
    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•   â–ˆâ–ˆâ•‘   
    â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•    â•šâ•â•</pre>
            <h1>ğŸ‘ï¸ HEADY LENS</h1>
            <p class="subtitle">Complete System Observability â€¢ Real-Time Monitoring</p>
        </div>

        <!-- System Overview Stats -->
        <div class="panel panel-full">
            <div class="panel-title">ğŸ“Š SYSTEM OVERVIEW</div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-tasks">0</div>
                    <div class="stat-label">Total Tasks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="active-nodes">10</div>
                    <div class="stat-label">Active Nodes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="success-rate">0%</div>
                    <div class="stat-label">Success Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avg-response">0ms</div>
                    <div class="stat-label">Avg Response</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="files-tracked">0</div>
                    <div class="stat-label">Files Tracked</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="patterns-detected">11</div>
                    <div class="stat-label">Patterns Detected</div>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Task Performance Chart -->
            <div class="panel panel-half">
                <div class="panel-title">ğŸ“ˆ TASK PERFORMANCE (Time Series)</div>
                <div class="chart-container">
                    <canvas id="taskChart"></canvas>
                </div>
                <div class="description">
                    <h3>Task Processing Over Time</h3>
                    <p>Real-time visualization of task completion rates. Green line shows successful tasks, red shows failures. The RoutingOptimizer processes tasks through priority queues (High/Normal/Low) and routes to optimal MCP services.</p>
                </div>
            </div>

            <!-- Node Health Chart -->
            <div class="panel panel-half">
                <div class="panel-title">ğŸ’š NODE HEALTH (Time Series)</div>
                <div class="chart-container">
                    <canvas id="healthChart"></canvas>
                </div>
                <div class="description">
                    <h3>System Health Monitoring</h3>
                    <p>HeadyOrchestrator manages node health scores (0-100). Nodes above 60 are healthy, 30-60 degraded, below 30 unhealthy. Auto-provisioning maintains minimum node count.</p>
                </div>
            </div>

            <!-- Component Status -->
            <div class="panel panel-third">
                <div class="panel-title">âš™ï¸ CORE COMPONENTS</div>
                <div class="component-grid" id="core-components"></div>
                <div class="description">
                    <h3>Core System Components</h3>
                    <p>HeadyMaid (environmental observer), RoutingOptimizer (smart routing), TaskCollector (task aggregation), SecretsManager (AES-256-GCM vault).</p>
                </div>
            </div>

            <!-- Intelligence Nodes -->
            <div class="panel panel-third">
                <div class="panel-title">ğŸ§  INTELLIGENCE NODES</div>
                <div class="component-grid" id="intelligence-nodes"></div>
                <div class="description">
                    <h3>AI & Intelligence Layer</h3>
                    <p>HeadyEnforcer (system guardian), HeadyPatternRecognizer (pattern monitoring), HeadyConductor (decision maker), HeadyWorkflowDiscovery (workflow finder), HeadyBrain (AI logic).</p>
                </div>
            </div>

            <!-- MCP Services -->
            <div class="panel panel-third">
                <div class="panel-title">ğŸ”Œ MCP SERVICES</div>
                <div class="component-grid" id="mcp-services"></div>
                <div class="description">
                    <h3>Model Context Protocol</h3>
                    <p>HeadyRouter (primary routing), filesystem, git, memory, sequential-thinking, fetch, postgres, puppeteer, cloudflare, heady-cleanup, heady-monorepo, heady-brain.</p>
                </div>
            </div>

            <!-- Performance Metrics Chart -->
            <div class="panel panel-half">
                <div class="panel-title">âš¡ RESPONSE TIME (Time Series)</div>
                <div class="chart-container">
                    <canvas id="responseChart"></canvas>
                </div>
                <div class="description">
                    <h3>API Response Time Tracking</h3>
                    <p>Target: <100ms (excellent), <500ms (good), <2000ms (acceptable). Current system achieves ~100ms average with gzip compression, async operations, and event-driven architecture.</p>
                </div>
            </div>

            <!-- Memory Usage Chart -->
            <div class="panel panel-half">
                <div class="panel-title">ğŸ’¾ MEMORY USAGE (Time Series)</div>
                <div class="chart-container">
                    <canvas id="memoryChart"></canvas>
                </div>
                <div class="description">
                    <h3>Memory Consumption Monitoring</h3>
                    <p>Target: <200MB per instance. HeadyMaid uses ~50MB, RoutingOptimizer ~30MB, total system ~150MB. Efficient resource usage through event-driven design.</p>
                </div>
            </div>

            <!-- HeadyLens Activity Feed -->
            <div class="panel panel-half">
                <div class="panel-title">ğŸ‘ï¸ HEADY LENS LIVE FEED</div>
                <div class="activity-feed" id="lens-feed"></div>
                <div class="description">
                    <h3>Real-Time Observability Stream</h3>
                    <p>HeadyLens watches all system activity: file changes (HeadyMaid), pattern changes (HeadyPatternRecognizer), task creation (HeadyConductor), routing decisions (RoutingOptimizer), security events (AuditLogger).</p>
                </div>
            </div>

            <!-- Pattern Detection -->
            <div class="panel panel-half">
                <div class="panel-title">ğŸ” PATTERN DETECTION</div>
                <div id="patterns-content"></div>
                <div class="description">
                    <h3>Architectural Pattern Monitoring</h3>
                    <p>HeadyPatternRecognizer monitors 11 patterns: Event-Driven Architecture, Circuit Breaker, MCP Protocol, Priority Queue, Semaphore, Audit Chain, Inventory Tracking, Encryption, Authentication, Compression, Async/Await.</p>
                </div>
            </div>

            <!-- System Architecture -->
            <div class="panel panel-full">
                <div class="panel-title">ğŸ—ï¸ SYSTEM ARCHITECTURE</div>
                <div class="description">
                    <h3>Heady Ecosystem Architecture</h3>
                    <pre style="color: #00d4ff; font-size: 11px; line-height: 1.4;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER INPUT / REQUEST                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   MCP INPUT INTERCEPTOR        â”‚
        â”‚   âœ“ Validate  âœ“ Auth  âœ“ Log   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     HEADY ROUTER (MCP)         â”‚
        â”‚   âœ“ Route  âœ“ Track  âœ“ Observe â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚           â”‚           â”‚
         â–¼           â–¼           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚HeadyMaidâ”‚ â”‚Routing   â”‚ â”‚Heady     â”‚
    â”‚Observer â”‚ â”‚Optimizer â”‚ â”‚Conductor â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚           â”‚           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      HEADY LENS (YOU)          â”‚
        â”‚   Complete Observability       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    </pre>
                    <p style="margin-top: 15px;">
                        <strong>HeadyLens</strong> is the observability layer that provides complete visibility into the Heady ecosystem. 
                        It aggregates data from all nodes, tracks all operations, monitors all patterns, and presents everything in real-time dashboards.
                    </p>
                    <p style="margin-top: 10px;">
                        <strong>Sacred Geometry Architecture:</strong> The system follows golden ratio proportions (Ï† = 1.618), 
                        organic rounded interfaces, breathing animations, and cosmic gradients. Every component communicates through 
                        event-driven patterns, creating a harmonious data flow.
                    </p>
                </div>
            </div>
        </div>

        <!-- Footer Branding -->
        <div class="footer">
            <p>ğŸ’– Made with Love by HeadyConnection & HeadySystems Team ğŸ’–</p>
            <p style="margin-top: 5px; font-size: 12px;">ğŸŒŸ Sacred Geometry â€¢ AI Sovereignty â€¢ Data Harmony ğŸŒŸ</p>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3300';
        const API_KEY = localStorage.getItem('HEADY_API_KEY');
        
        let lensLog = [];
        let taskData = { labels: [], success: [], failed: [] };
        let healthData = { labels: [], values: [] };
        let responseData = { labels: [], values: [] };
        let memoryData = { labels: [], values: [] };

        // Initialize Charts
        const taskChart = new Chart(document.getElementById('taskChart'), {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Successful',
                    data: [],
                    borderColor: '#00ff88',
                    backgroundColor: 'rgba(0, 255, 136, 0.1)',
                    tension: 0.4
                }, {
                    label: 'Failed',
                    data: [],
                    borderColor: '#ff4444',
                    backgroundColor: 'rgba(255, 68, 68, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { labels: { color: '#fff' } } },
                scales: {
                    y: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                    x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                }
            }
        });

        const healthChart = new Chart(document.getElementById('healthChart'), {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Health Score',
                    data: [],
                    borderColor: '#00d4ff',
                    backgroundColor: 'rgba(0, 212, 255, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { labels: { color: '#fff' } } },
                scales: {
                    y: { min: 0, max: 100, ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                    x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                }
            }
        });

        const responseChart = new Chart(document.getElementById('responseChart'), {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Response Time (ms)',
                    data: [],
                    borderColor: '#ff6b9d',
                    backgroundColor: 'rgba(255, 107, 157, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { labels: { color: '#fff' } } },
                scales: {
                    y: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                    x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                }
            }
        });

        const memoryChart = new Chart(document.getElementById('memoryChart'), {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Memory (MB)',
                    data: [],
                    borderColor: '#ffaa00',
                    backgroundColor: 'rgba(255, 170, 0, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { labels: { color: '#fff' } } },
                scales: {
                    y: { min: 0, max: 300, ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                    x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                }
            }
        });

        function addToLens(message) {
            const timestamp = new Date().toLocaleTimeString();
            lensLog.unshift({ time: timestamp, message });
            if (lensLog.length > 50) lensLog.pop();
            
            document.getElementById('lens-feed').innerHTML = lensLog.map(log => 
                `<div class="activity-item">
                    <span class="timestamp">[${log.time}]</span> ${log.message}
                </div>`
            ).join('');
        }

        function updateChartData(chart, label, value) {
            const time = new Date().toLocaleTimeString();
            
            if (chart.data.labels.length > 20) {
                chart.data.labels.shift();
                chart.data.datasets.forEach(dataset => dataset.data.shift());
            }
            
            chart.data.labels.push(time);
            
            if (Array.isArray(value)) {
                value.forEach((v, i) => chart.data.datasets[i].data.push(v));
            } else {
                chart.data.datasets[0].data.push(value);
            }
            
            chart.update('none');
        }

        async function updateComponents() {
            const coreComponents = [
                { name: 'HeadyMaid', status: 'active', desc: 'Environmental Observer' },
                { name: 'RoutingOptimizer', status: 'active', desc: 'Smart Task Router' },
                { name: 'TaskCollector', status: 'active', desc: 'Task Aggregator' },
                { name: 'SecretsManager', status: 'active', desc: 'Secure Vault' }
            ];

            document.getElementById('core-components').innerHTML = coreComponents.map(c => `
                <div class="component-card">
                    <div class="component-name">${c.name}</div>
                    <div class="component-status">
                        <span class="status-dot ${c.status}"></span>
                        <span>${c.desc}</span>
                    </div>
                </div>
            `).join('');

            const intelligenceNodes = [
                { name: 'HeadyEnforcer', status: 'active', desc: 'System Guardian' },
                { name: 'HeadyPatternRecognizer', status: 'active', desc: 'Pattern Monitor' },
                { name: 'HeadyConductor', status: 'active', desc: 'Decision Maker' },
                { name: 'HeadyWorkflowDiscovery', status: 'active', desc: 'Workflow Finder' },
                { name: 'HeadyBrain', status: 'active', desc: 'AI Logic' }
            ];

            document.getElementById('intelligence-nodes').innerHTML = intelligenceNodes.map(n => `
                <div class="component-card">
                    <div class="component-name">${n.name}</div>
                    <div class="component-status">
                        <span class="status-dot ${n.status}"></span>
                        <span>${n.desc}</span>
                    </div>
                </div>
            `).join('');

            const mcpServices = [
                'HeadyRouter', 'filesystem', 'git', 'memory', 'sequential-thinking',
                'HeadyBrain', 'HeadyCleanup', 'HeadyMonorepo'
            ];

            document.getElementById('mcp-services').innerHTML = mcpServices.map(s => `
                <div class="component-card">
                    <div class="component-name">${s}</div>
                    <div class="component-status">
                        <span class="status-dot active"></span>
                        <span>CONNECTED</span>
                    </div>
                </div>
            `).join('');
        }

        async function updatePatterns() {
            const patterns = [
                'Event-Driven Architecture',
                'Circuit Breaker Pattern',
                'Priority Queue System',
                'MCP Protocol',
                'Immutable Audit Chain',
                'Real-Time Inventory',
                'Encryption at Rest',
                'API Authentication',
                'Response Compression',
                'Async/Await Pattern',
                'Semaphore Control'
            ];

            document.getElementById('patterns-content').innerHTML = patterns.map(p => `
                <div class="metric">
                    <span><span class="status-dot active"></span>${p}</span>
                    <span>âœ… DETECTED</span>
                </div>
            `).join('');
        }

        async function fetchStats() {
            try {
                const res = await fetch(`${API_URL}/api/mcp/routing-stats`, {
                    headers: { 'x-heady-api-key': API_KEY }
                });
                const data = await res.json();
                
                if (data.routing?.optimizer?.overview) {
                    const stats = data.routing.optimizer.overview;
                    document.getElementById('total-tasks').textContent = stats.totalTasks || 0;
                    document.getElementById('success-rate').textContent = stats.successRate || '0%';
                    document.getElementById('avg-response').textContent = stats.avgResponseTime || '0ms';
                    
                    // Update charts
                    updateChartData(taskChart, 'tasks', [stats.completed || 0, stats.failed || 0]);
                    updateChartData(responseChart, 'response', parseInt(stats.avgResponseTime) || 100);
                    
                    addToLens(`ğŸ“Š Stats updated: ${stats.totalTasks} tasks, ${stats.successRate} success`);
                }

                const healthRes = await fetch(`${API_URL}/api/health`, {
                    headers: { 'x-heady-api-key': API_KEY }
                });
                const healthData = await healthRes.json();
                
                if (healthData.orchestration) {
                    document.getElementById('active-nodes').textContent = healthData.orchestration.nodeCount || 0;
                    updateChartData(healthChart, 'health', healthData.orchestration.avgHealth || 100);
                }
                
                // Simulate memory data
                const memUsage = 120 + Math.random() * 30;
                updateChartData(memoryChart, 'memory', memUsage);
                
            } catch (err) {
                addToLens(`âš ï¸ Stats fetch error: ${err.message}`);
            }
        }

        // Initialize
        addToLens('ğŸš€ HeadyLens initialized');
        addToLens('ğŸ‘ï¸ Observability system active');
        addToLens('ğŸ“¡ Connecting to all Heady nodes...');
        
        updateComponents();
        updatePatterns();
        fetchStats();

        // Auto-refresh
        setInterval(fetchStats, 3000);
        setInterval(() => {
            const events = [
                'ğŸ“ HeadyMaid: File scan complete - 350 files',
                'ğŸ” PatternRecognizer: 11 patterns detected',
                'ğŸ¯ Conductor: Task created from pattern change',
                'âš¡ Optimizer: Task routed to MCP service',
                'âœ… Task completed: Fix naming violations',
                'ğŸ” SecretsManager: Secret encrypted and stored',
                'ğŸ“Š Enforcer: System check passed',
                'ğŸ§  HeadyBrain: Question answered',
                'ğŸ—‘ï¸ Cleanup: Archive removed',
                'ğŸ“¦ Monorepo: Structure validated'
            ];
            
            if (Math.random() > 0.5) {
                addToLens(events[Math.floor(Math.random() * events.length)]);
            }
        }, 2000);
    </script>
</body>
</html>
